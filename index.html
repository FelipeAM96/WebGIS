<!DOCTYPE html>
<html>
<head>
    <title>SIGMA - WebGIS</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-switch-layers/dist/leaflet-switch-layers.css" />
    <style>
        body {
            background-color: #f1f1f6;
            margin: 0;
            padding: 0;
        }
        #header {
            text-align: center;
            font-size: 9vh;
            font-family: 'Lexend', sans-serif;
            font-weight: normal;
            margin-top: 6vh;
        }
        #map-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: calc(100vh - 60px);
        }
        .map {
            height: 80%;
            width: 50%;
            margin: 10px;
            border: 1px solid #ccc;
            position: relative; /* Adicionado */
        }
        .legend {
            position: absolute;
            bottom: 50px; /* Ajuste de posiÃ§Ã£o */
            left: 10px;
            background-color: white;
            padding: 5px;
            font-size: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            z-index: 1000; /* Adicionado */
        }
        #logo-left {
            position: absolute;
            top: 3vh;
            left: 2vh;
            max-height: 20vh;
        }
        #logo-right {
            position: absolute;
            top: 1vh;
            right: 2vh;
            max-height: 20vh;
        }
        #text_sigma {
            text-align: center;
            font-family: 'Lexend', sans-serif;
            font-size: 15px;
            padding-bottom: 2vh; /* Adicionado para espaÃ§amento inferior */
        }
        #footer {
            text-align: center;
            font-family: 'Lexend', sans-serif;
            font-size: 11px;
            margin-top: 20px;
            padding-bottom: 20px; /* Adicionado para espaÃ§amento inferior */
            color: rgb(92, 91, 91);
        }
        /* Estilo para o Geocoder */
        .leaflet-control-geocoder {
            width: 300px; /* Ajuste conforme necessÃ¡rio */
            font-size: 14px; /* Ajuste conforme necessÃ¡rio */
        }
        .leaflet-control-geocoder.leaflet-touch {
            width: auto; /* Ajuste conforme necessÃ¡rio */
        }
    </style>
</head>
<body>
    <div id="header">
        <img src="Image1.png" alt="Imagem Esquerda" id="logo-left">
        ForÃªts Toulouse Sud
        <img src="Image2.png" alt="Imagem Direita" id="logo-right">
    </div>
    <div id="map-container">
        <div id="map1" class="map">
            <div class="legend" id="legend1">
                Legend goes here for Map 1
            </div>
        </div>
        <div id="map2" class="map">
            <div class="legend" id="legend2">
                Legend goes here for Map 2
            </div>
        </div>
    </div>
    <div id="text_sigma">
        Analyse forestiÃ¨re de petite Ã©chelle dans la rÃ©gion de Toulouse sud Ã  partir d'images Sentinel 2 (L2A). <br>
        Classification supervisÃ©e et calcul du NDVI des forÃªts rÃ©alisÃ©s Ã  l'aide d'images matricielles et de donnÃ©es provenant de la base de donnÃ©es BD ForÃªtÂ® version 2.0 comme rÃ©fÃ©rence pour les Ã©chantillons.    </div>

    <div id="footer">
        <b>MASTER 2 GÃ‰OMATIQUE <br>
        ScIences GÃ©omatiques en environneMent et AmÃ©nagement (SIGMA)</b><br><br>
        Auteur : Felipe AGUIAR MARTIN
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="https://unpkg.com/leaflet-switch-layers/dist/leaflet-switch-layers.js"></script>
    <script src="https://unpkg.com/leaflet-minimap/dist/Control.MiniMap.min.js"></script>
    <script>
        // Criar o mapa 1
        var map1 = L.map('map1').setView([43.3860585,1.3935381,13], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map1);
        L.control.scale({ imperial: false }).addTo(map1); // Adiciona a barra de escala em kmÂ² ao map1

        // Adicionar o MiniMap ao mapa 1 com estilo "Dark" do OpenTopoMap
        var miniMap1 = new L.Control.MiniMap(
            L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://opentopomap.org/">OpenTopoMap</a> contributors'
            }), 
            { toggleDisplay: true }
        );
        miniMap1.addTo(map1);

        // Personalizar estilo CSS do mini mapa 1
        miniMap1._container.style.border = '1px solid black'; // Adiciona uma borda preta de 2 pixels ao redor do mini mapa 1

        // Adicionar o Geocoder ao mapa 1
        var geocoder1 = L.Control.geocoder({
            defaultMarkGeocode: false,
            placeholder: 'Pesquisar localizaÃ§Ã£o...',
            geocoder: L.Control.Geocoder.nominatim()
        })
        .on('markgeocode', function(event) {
            var result = event.geocode;
            map1.fitBounds(result.bbox);
        })
        .addTo(map1);

        // Adicionar camada WMS padrÃ£o ao mapa1
        L.tileLayer.wms('https://geotests.net/geoserver/FelipeAM/wms', {
            layers: 'FelipeAM:masque_foret',
            format: 'image/png',
            transparent: true
        }).addTo(map1);

        // Definir a legenda para o mapa1
        document.getElementById('legend1').innerHTML = '<b>Classes forÃªt :</b><br>\
    <span style="color: green;">ð’Š¹</span> <span style="color: black;"></span>  Feuillus <br>\
    <span style="color: gold;">ð’Š¹</span> <span style="color: black;"></span>  Peupleraie <br>\
    <span style="color: black;">ð’Š¹</span> <span style="color: black;"></span>  ConifÃ¨res autre que pins <br>\
    <span style="color: blue;">ð’Š¹</span> <span style="color: black;"></span>  Pins <br>\
    <span style="color: cyan;">ð’Š¹</span> <span style="color: black;"></span>  MÃ©lange pins et autre conifÃ¨res';

        // Mover a camada 'FelipeAM:Groupe6_carte_essences_lvl2' para o mapa 1
        var layerGroupe6 = L.tileLayer.wms('https://geotests.net/geoserver/FelipeAM/wms', {
            layers: 'FelipeAM:Groupe6_carte_essences_lvl2',
            format: 'image/png',
            transparent: true
        }).addTo(map1);

        // Criar o mapa 2
        var map2 = L.map('map2').setView([43.3860585,1.3935381,13], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
        }).addTo(map2);
        L.control.scale({ imperial: false }).addTo(map2); // Adiciona a barra de escala em kmÂ² ao map2

        // Adicionar o MiniMap ao mapa 2 com estilo "Dark" do OpenTopoMap
        var miniMap2 = new L.Control.MiniMap(
            L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://opentopomap.org/">OpenTopoMap</a> contributors'
            }), 
            { toggleDisplay: true }
        );
        miniMap2.addTo(map2);

        // Personalizar estilo CSS do mini mapa 2
        miniMap2._container.style.border = '1px solid black'; // Adiciona uma borda preta de 2 pixels ao redor do mini mapa 2

        // Adicionar o Geocoder ao mapa 2
        var geocoder2 = L.Control.geocoder({
            defaultMarkGeocode: false,
            placeholder: 'Pesquisar localizaÃ§Ã£o...',
            geocoder: L.Control.Geocoder.nominatim()
        })
        .on('markgeocode', function(event) {
            var result = event.geocode;
            map2.fitBounds(result.bbox);
        })
        .addTo(map2);

        // Adicionar controle de camadas para mapa2
        var baseMaps = {
            'OpenStreetMap': L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
            })
        };

        var overlayMaps = {
            'NDVI 09/02/2022': L.tileLayer.wms('https://geotests.net/geoserver/FelipeAM/wms', {
                layers: 'FelipeAM:NDVI_20220209',
                format: 'image/png',
                transparent: true
            }),
            'NDVI 22/09/2022': L.tileLayer.wms('https://geotests.net/geoserver/FelipeAM/wms', {
                layers: 'FelipeAM:NDVI_20220922',
                format: 'image/png',
                transparent: true
            })
        };

        // Adiciona a camada 'FelipeAM:NDVI_20220922' como ativa por padrÃ£o
        overlayMaps['NDVI 22/09/2022'].addTo(map2);

        L.control.layers(baseMaps, overlayMaps).addTo(map2);

        // Definir a legenda para o mapa2
        document.getElementById('legend2').innerHTML = '<b>Classes NDVI :</b><br>\
    <span style="color: red;">ð’Š¹</span> <span style="color: black;"></span>  Sol nu <br>\
    <span style="color: orange;">ð’Š¹</span> <span style="color: black;"></span>  Sol nu et vegetation mort <br>\
    <span style="color: Khaki;">ð’Š¹</span> <span style="color: black;"></span>  Vegetation faible <br>\
    <span style="color: LightGreen;">ð’Š¹</span> <span style="color: black;"></span>  Vegetation moyenne <br>\
    <span style="color: green;">ð’Š¹</span> <span style="color: black;"></span>  Vegetation forte active';

        // Sincronize a visualizaÃ§Ã£o do map1 com o map2
        var syncMaps = true;
        map1.on('moveend', function() {
            if (syncMaps) {
                syncMaps = false;
                map2.setView(map1.getCenter(), map1.getZoom());
                setTimeout(function() {
                    syncMaps = true;
                }, 100); // Tempo de espera em milissegundos antes de reativar a sincronizaÃ§Ã£o
            }
        });

        // Sincronize a visualizaÃ§Ã£o do map2 com o map1
        map2.on('moveend', function() {
            if (syncMaps) {
                syncMaps = false;
                map1.setView(map2.getCenter(), map2.getZoom());
                setTimeout(function() {
                    syncMaps = true;
                }, 100); // Tempo de espera em milissegundos antes de reativar a sincronizaÃ§Ã£o
            }
        });

        // FunÃ§Ã£o para obter o valor do atributo 'TFV' da camada shape 'FelipeAM:masque_foret'
        function getTFVValue(latlng) {
            var url = 'https://geotests.net/geoserver/FelipeAM/wms?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetFeatureInfo&LAYERS=FelipeAM:masque_foret&QUERY_LAYERS=FelipeAM:masque_foret&INFO_FORMAT=application/json&FEATURE_COUNT=50&X=' + latlng.lng + '&Y=' + latlng.lat + '&SRS=EPSG:4326&WIDTH=256&HEIGHT=256';

            fetch(url)
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    // Verifica se hÃ¡ features retornadas
                    if (data.features.length > 0) {
                        // ObtÃ©m o valor do atributo 'TFV' da primeira feature
                        var tfvValue = data.features[0].properties.TFV;
                        console.log("Valor de TFV:", tfvValue);
                    } else {
                        console.log("Nenhuma feature retornada.");
                    }
                })
                .catch(function(error) {
                    console.error('Erro ao obter valor de TFV:', error);
                });
        }

        // Adiciona um evento de clique no mapa para obter o valor do atributo 'TFV' na posiÃ§Ã£o do clique
        map1.on('click', function(event) {
            getTFVValue(event.latlng);
        });
    </script>
</body>
</html>
